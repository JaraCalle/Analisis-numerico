{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análisis Numérico</title>
    <style>
        .section {
        display: none;
        padding: 1rem;
        }

        .active {
        display: block;
        }
    </style>
</head>
<body>
    <nav>
        <a onclick="showSection('enl')">Solución de Ecuaciones no Lineales (ENL)</a>
        <a onclick="showSection('reporte_enl')">Reporte ENL</a>
        <a onclick="showSection('iterativos')">Métodos Iterativos</a>
    </nav>

    <!-- Solución de Ecuaciones no Lineales (ENL) -->

    <div id="enl" class="section {% if formulario_activo == "enl" or not formulario_activo %}active{% endif %}">
        <form method="post">
            {% csrf_token %}

            <input type="hidden" name="formulario" value="enl">
    
            <label for="funcion">Función f(x):</label>
            <input type="text" id="funcion" name="funcion" required>
    
            <br><br>
            <label for="iteraciones">Número de iteraciones:</label>
            <input type="number" name="iteraciones" min="1" required>
    
            <br><br>
            <label for="metodo">Elija un método:</label>
            <select id="metodo" name="metodo" onchange="actualizarFormularioENL()" required>
                <option value="">-- Seleccione --</option>
                <option value="Biseccion">Bisección</option>
                <option value="Regla Falsa">Regla Falsa</option>
                <option value="Punto Fijo">Punto Fijo</option>
                <option value="Newton">Newton</option>
                <option value="Secante">Secante</option>
                <option value="Newton M2">Raíces Múltiples</option>
            </select>
    
            <br><br>
            <label>Tipo de tolerancia:</label><br>
            <input type="radio" id="dc" name="tipo_error" value="DC" required>
            <label for="dc">Decimales Correctos</label><br>
            <input type="radio" id="cs" name="tipo_error" value="CS">
            <label for="cs">Cifras Significativas</label><br>
    
            <label for="tolerancia">Ingrese valor de tolerancia:</label>
            <input type="text" id="tolerancia" name="tolerancia" required>
    
            <br><br>
    
            <!-- Intervalo (solo para Bisección y Regla Falsa) -->
            <div id="intervalo" style="display:none;">
                <label for="inferior">Límite inferior del intervalo:</label>
                <input type="text" name="inferior"><br>
    
                <label for="superior">Límite superior del intervalo:</label>
                <input type="text" name="superior"><br>
            </div>
    
            <!-- Punto inicial (excepto Secante) -->
            <div id="punto_inicial" style="display:none;">
                <label for="punto_inicial">Punto inicial:</label>
                <input type="text" id="punto" name="punto_inicial"><br>
            </div>
    
            <!-- Punto inicial para Secante -->
            <div id="punto_inicial_secante" style="display:none;">
                <label for="punto_inicial_1">Punto inicial 1:</label>
                <input type="text" name="punto_inicial_1"><br>
    
                <label for="punto_inicial_2">Punto inicial 2:</label>
                <input type="text" name="punto_inicial_2"><br>
            </div>
    
            <!-- g(x) para Punto Fijo -->
            <div id="gx_input" style="display:none;">
                <label for="g">Función g(x):</label>
                <input type="text" name="g"><br>
            </div>
    
            <!-- f'(x) para Newton y Raíces Múltiples -->
            <div id="derivada1_input" style="display:none;">
                <label for="derivada">Primera derivada f'(x):</label>
                <input type="text" name="derivada"><br>
            </div>
    
            <!-- f''(x) solo para Raíces Múltiples -->
            <div id="derivada2_input" style="display:none;">
                <label for="segunda_derivada">Segunda derivada f''(x):</label>
                <input type="text" name="segunda_derivada"><br>
            </div>
    
            <br>
            <button type="submit">Calcular Raíces</button>
        </form>

        {% if messages %}
        <ul class="messages">
            {% for message in messages %}
            <li class="{{ message.tags }}">{{ message }}</li>
            {% endfor %}
        </ul>
        {% endif %}
    
        <h1>Resultados</h1>
        <div>
            {{ tabla|safe }}
        </div>
    
        <h1>Gráfica</h1>
        
        <!-- Aquí se incluye el gráfico interactivo de Plotly -->
        <div>
            {{ grafico|safe }}
        </div>
    </div>

    <!-- Reporte ENL -->

    <div id="reporte_enl" class="section {% if formulario_activo == "reporte_enl" %}active{% endif %}">
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="formulario" value="reporte_enl">

            <label for="funcion">Función f(x):</label>
            <input type="text" id="funcion" name="funcion" required>
    
            <label for="iteraciones">Número de iteraciones:</label>
            <input type="number" name="iteraciones" min="1" required>
    
            <label>Tipo de tolerancia:</label><br>
            <input type="radio" id="dc" name="tipo_error" value="DC" required>
            <label for="dc">Decimales Correctos</label><br>
            <input type="radio" id="cs" name="tipo_error" value="CS">
            <label for="cs">Cifras Significativas</label><br>
    
            <label for="tolerancia">Ingrese valor de tolerancia:</label>
            <input type="text" id="tolerancia" name="tolerancia" required>

            <div id="intervalo">
                <label for="inferior">Límite inferior del intervalo:</label>
                <input type="text" name="inferior"><br>
    
                <label for="superior">Límite superior del intervalo:</label>
                <input type="text" name="superior"><br>
            </div>
    
            <div id="punto_inicial_secante">
                <label for="punto_inicial_1">Punto inicial 1:</label>
                <input type="text" name="punto_inicial_1"><br>
    
                <label for="punto_inicial_2">Punto inicial 2:</label>
                <input type="text" name="punto_inicial_2"><br>
            </div>
    
            <div id="gx_input">
                <label for="g">Función g(x):</label>
                <input type="text" name="g"><br>
            </div>
    
            <div id="derivada1_input">
                <label for="derivada">Primera derivada f'(x):</label>
                <input type="text" name="derivada"><br>
            </div>
    
            <div id="derivada2_input">
                <label for="segunda_derivada">Segunda derivada f''(x):</label>
                <input type="text" name="segunda_derivada"><br>
            </div>
    
            <button type="submit">Generar Reporte</button>

            {% if messages %}
            <ul class="messages">
                {% for message in messages %}
                <li class="{{ message.tags }}">{{ message }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        
            <h1>Reporte</h1>
            <div>
                {{ reporte|safe }}
            </div>
        
            <h1>Tabla Solución</h1>
            
            <div>
                {{ tabla|safe }}
            </div>
        </form>
    </div>

    <!-- Métodos Iterativos -->

    <div id="iterativos" class="section {% if formulario_activo == "iterativos" %}active{% endif %}">
        <form method="post" onsubmit="return validarFormulario()">
            {% csrf_token %}

            <input type="hidden" name="formulario" value="iterativos">

            <label for="size_A">Tamaño de la matriz A:</label>
            <input type="number" id="size_A" name="size_A" min="1" max="10" required onchange="generarMatriz()">

            <div id="contenedor-matriz"></div>
    
            <div id="contenedor-vector-b"></div>

            <div id="contenedor-vector-x0"></div>

            <label for="metodo_iterativo">Elija un método:</label>
            <select id="metodo_iterativo" name="metodo_iterativo" onchange="actualizarFormularioIterativas()" required>
                <option value="">-- Seleccione --</option>
                <option value="jacobi">Jacobi</option>
                <option value="seidel">Gauss-Seidel</option>
                <option value="sor">Relajación (SOR)</option>
            </select>

            <div id="peso_w_input" style="display:none;">
                <label for="peso_w">Peso w:</label>
                <input type="number" step="any" name="peso_w"><br>
            </div>
    
            <label>Tipo de tolerancia:</label><br>
            <input type="radio" id="dc" name="tipo_error" value="DC" required>
            <label for="dc">Decimales Correctos</label><br>
            <input type="radio" id="cs1" name="tipo_error" value="CS1">
            <label for="cs1">Cifras Significativas con División Punto</label>
            <input type="radio" id="cs2" name="tipo_error" value="CS2">
            <label for="cs2">Cifras Significativas con División por la Norma</label>
    
            <label for="tolerancia">Ingrese valor de tolerancia:</label>
            <input type="text" id="tolerancia" name="tolerancia" required>

            <label for="iteraciones">Número de iteraciones:</label>
            <input type="number" name="iteraciones" min="1" required>

    
            <button type="submit">Calcular Solución</button>

            {% if messages %}
            <ul class="messages">
                {% for message in messages %}
                <li class="{{ message.tags }}">{{ message }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        
            <h1>Solución del Método</h1>
            <div>
                {{ tabla|safe }}
            </div>
        
            <h1>Comparación con Otros Métodos</h1>
            
            <div>
                <p>A continuación se presenta una tabla de comparación entre los tres métodos. Para el método SOR se hicieron iteraciones adicionales con pesos aleatorios.</p>
                {{ reporte|safe }}
            </div>
        </form>
    </div>
</body>
<script src="{% static 'js/inicio.js' %}"></script>
</html>